<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://sitodo-example.herokuapp.com/bootcamp/day-1/basic-list/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Create a Basic Todo List - Sitodo</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Create a Basic Todo List";
        var mkdocs_page_input_path = "bootcamp\\day-1\\basic-list.md";
        var mkdocs_page_url = "/bootcamp/day-1/basic-list/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Sitodo
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../..">Course Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Day One</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../init-spring/">Initialise Project</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hello-tdd/">Hello, TDD</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../qa-automation/">Deployment Automation</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Create a Basic Todo List</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#data-persistence-layer">Data Persistence Layer</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#repository-layer">Repository Layer</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#service-layer">Service Layer</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#test-initial-implementation">Test Initial Implementation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#back-to-controller-and-view">Back to Controller and View</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#complete-the-basic-functionality">Complete the Basic Functionality</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../end-day-1/">Recap</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Day Two</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../day-2/test-automation/">Test Automation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../day-2/update-data-model/">One of Many Lists</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../day-2/database-migration/">Database Migration</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Sitodo</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Day One &raquo;</li>
      <li>Create a Basic Todo List</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="create-a-basic-todo-list">Create a Basic Todo List</h1>
<h2 id="data-persistence-layer">Data Persistence Layer</h2>
<p>Create a new class named <code>TodoItem</code> in the production code, specifically in a new package named <code>model</code>:</p>
<pre><code class="language-java">import lombok.Data;
import lombok.NoArgsConstructor;

import javax.persistence.*;

@Data
@Entity
@NoArgsConstructor
public class TodoItem {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    private Long id;

    @Column(nullable = false)
    private String title;

    @Column
    private Boolean finished = Boolean.FALSE;

    public TodoItem(String title) {
        this.title = title;
    }

    public TodoItem(Long id, String title) {
        this.id = id;
        this.title = title;
    }
}
</code></pre>
<h2 id="repository-layer">Repository Layer</h2>
<p>Create a new Java interface named <code>TodoListRepository</code> that extends <code>CrudRepository</code> interface provided by Spring JPA.
Put the new Java interface in a new package called <code>repository</code> in the production code.
We will use it to implement a data access layer in between the data model and business logic layers.
The <code>TodoListRepository</code> implementation is short and can be seen in the following code snippet:</p>
<pre><code class="language-java">// Removed some import statements for brevity.
import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface TodoListRepository extends CrudRepository&lt;TodoItem, Long&gt; {
}
</code></pre>
<h2 id="service-layer">Service Layer</h2>
<p>Create a new package called <code>service</code> in the production code.
Then, create a new class named <code>TodoListService</code> in the new package.
We will use <code>service</code> package to contain classes related to service layer of the app,
i.e. classes that provide implementations related to business logic.
The content of <code>TodoListService</code> is as follows:</p>
<pre><code class="language-java">// Removed some import statements for brevity.
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import java.util.List;

@Service
public class TodoListService {

    private TodoListRepository todoListRepository;

    @Autowired
    public void setTodoListRepository(TodoListRepository todoListRepository) {
        this.todoListRepository = todoListRepository;
    }
}
</code></pre>
<p>Since we will implement a basic todo list that shows a list of todo items,
we need to implement methods that can add and retrieve todo items:</p>
<pre><code class="language-java">public class TodoListService {
    // Omitted for brevity
    private TodoListRepository todoListRepository;

    public List&lt;TodoItem&gt; getTodoItems() {
        return todoListRepository.findAll();
    }

    public TodoItem addTodoItem(TodoItem todoItem) {
        return todoListRepository.save(todoItem);
    }
}
</code></pre>
<h2 id="test-initial-implementation">Test Initial Implementation</h2>
<p>You might question: "Do we need to test the repository and service classes?"
The implementation of both layers is quite simple at this point, so one might wonder if it is worth testing them.
The repository layer can be left untested at the moment because we did not customise the inherited implementation.
The service layer, however, needs to be tested because it is related to business logic that is domain-specific to the problem.</p>
<p>Create a new class named <code>TodoListService</code> in the test code and ensure the package structure follows the production code.
In the new class, implement the test cases that verify the expected correct behaviour of both <code>getTodoItems</code> and <code>addTodoItem</code>:</p>
<pre><code class="language-java">import com.example.sitodo.model.TodoItem;
import com.example.sitodo.repository.TodoListRepository;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;

import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.when;

@SpringBootTest
class TodoListServiceTest {

    @Autowired
    private TodoListService todoListService;

    @MockBean
    private TodoListRepository todoListRepository;

    @Test
    void getTodoItems_someItems_ok() {
        when(todoListRepository.findAll()).thenReturn(List.of(
            new TodoItem(&quot;A&quot;),
            new TodoItem(&quot;B&quot;),
            new TodoItem(&quot;C&quot;)
        ));

        List&lt;TodoItem&gt; todoItems = todoListService.findAll();

        assertEquals(3, todoItems.size());
    }

    @Test
    void addTodoItem_ok() {
        TodoItem todoItem = new TodoItem(&quot;Buy milk&quot;);
        when(todoListRepository.save(any(TodoItem.class))).thenReturn(todoItem);

        TodoItem savedTodoItem = todoListService.addTodoItem(todoItem);

        assertEquals(&quot;Buy milk&quot;, savedTodoItem.getTitle());
    }
}
</code></pre>
<p>Maybe you noticed that the tests look different from the one you created in the previous section.
The tests above implement a mock object that serves as a stand-in of an actual object during testing.
The mock object can be configured to simulate a behaviour specific during testing.
We use a mock object to ensure the test in the service layer is independent of the repository layer.</p>
<h2 id="back-to-controller-and-view">Back to Controller and View</h2>
<p>You have implemented the business logic of adding and listing a todo list.
The next step is to implement the controller to handle requests from the user.
But before that, in spirit of TDD, let us create a test first.
Let us start by implementing a method to retrieve the todo list.</p>
<p>Create a new class named <code>TodoListControllerTest</code> in the test code:</p>
<blockquote>
<p>You know where to put it, right?
Controller classes go into controller package.
Maintain proper separation of concern in your codebase!</p>
</blockquote>
<pre><code class="language-java">// Removed some import statements for brevity.
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.DisplayName;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.test.web.servlet.MockMvc;

import static java.nio.charset.StandardCharsets.UTF_8;
import static org.hamcrest.Matchers.*;
import static org.mockito.ArgumentMatchers.anyBoolean;
import static org.mockito.ArgumentMatchers.anyLong;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;
import static org.springframework.http.MediaType.TEXT_HTML;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

@WebMvcTest(TodoListController.class)
@Tag(&quot;unit&quot;)
class TodoListControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private TodoListService todoListService;

    // New annotation!
    // @DisplayName allows you to customise the name of a test case.
    @Test
    @DisplayName(&quot;HTTP GET '/list' retrieves list view&quot;)
    void showList_correctView() throws Exception {
        mockMvc.perform(get(&quot;/list&quot;)).andExpectAll(
            status().isOk(),
            content().contentTypeCompatibleWith(TEXT_HTML),
            content().encoding(UTF_8),
            view().name(&quot;list&quot;)
        );
    }

    @Test
    @DisplayName(&quot;HTTP GET '/list' returns an HTML page&quot;)
    void showList_returnHtml() throws Exception {
        mockMvc.perform(get(&quot;/list&quot;)).andExpectAll(
            status().isOk(),
            content().contentTypeCompatibleWith(TEXT_HTML),
            content().encoding(UTF_8),
            content().string(containsString(&quot;&lt;/html&gt;&quot;))
        );
    }

    @Test
    @DisplayName(&quot;HTTP GET '/list' returns an HTML page with non-empty list&quot;)
    void showList_withSampleData_ok() throws Exception {
        TodoItem mockTodoItem = new TodoItem(&quot;Buy milk&quot;);
        when(todoListService.getTodoItems()).thenReturn(List.of(mockTodoItem));

        mockMvc.perform(get(&quot;/list&quot;)).andExpectAll(
            status().isOk(),
            content().contentTypeCompatibleWith(TEXT_HTML),
            content().encoding(UTF_8),
            content().string(containsString(&quot;Buy milk&quot;))
        );
    }
}
</code></pre>
<p>Implement the actual controller in the production code:</p>
<pre><code class="language-java">// Removed import statements for brevity
@Controller
public class TodoListController {

    private TodoListService todoListService;

    @Autowired
    public void setTodoListService(TodoListService todoListService) {
        this.todoListService = todoListService;
    }

    @GetMapping(&quot;/list&quot;)
    public String showList(Model model) {
        List&lt;TodoItem&gt; todoItems = todoListService.getTodoItems();

        model.add(&quot;todoList&quot;, todoItems);

        return &quot;list&quot;;
    }
}
</code></pre>
<p>Do not forget to create the HTML view of the todo list.
Create a new HTML view called <code>list.html</code> in <code>templates</code> directory at <code>src/main/resources</code>:</p>
<pre><code class="language-html">&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;/&gt;

    &lt;link th:rel=&quot;stylesheet&quot; th:href=&quot;@{/webjars/bootstrap/5.1.3/dist/css/bootstrap.css}&quot;/&gt;

    &lt;title&gt;Sitodo&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;container&quot;&gt;
    &lt;header class=&quot;d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom&quot;&gt;
        &lt;span class=&quot;fs-4&quot;&gt;SITODO&lt;/span&gt;
    &lt;/header&gt;
    &lt;table id=&quot;id_list_table&quot; class=&quot;table caption-top&quot;&gt;
        &lt;caption class=&quot;display-1&quot;&gt;Your Todo List&lt;/caption&gt;
        &lt;thead class=&quot;table-dark&quot;&gt;
        &lt;tr&gt;
            &lt;th scope=&quot;col&quot;&gt;ID&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Title&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Status&lt;/th&gt;
        &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
        &lt;tr th:each=&quot;item : ${todoList}&quot;&gt;
            &lt;td th:text=&quot;${item.id}&quot;&gt;1&lt;/td&gt;
            &lt;td th:text=&quot;${item.title}&quot;&gt;Cook rice&lt;/td&gt;
            &lt;td th:text=&quot;${item.finished} ? 'Finished' : 'Not Finished'&quot;&gt;Not Finished&lt;/td&gt;
        &lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;
    &lt;form action=&quot;/list&quot; method=&quot;post&quot;&gt;
        &lt;input type=&quot;text&quot; id=&quot;id_new_item&quot; name=&quot;item_text&quot; placeholder=&quot;Enter an item&quot;/&gt;
        &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary btn-sm&quot;&gt;Enter&lt;/button&gt;
    &lt;/form&gt;
&lt;/div&gt;
&lt;script th:src=&quot;@{/webjars/bootstrap/5.1.3/dist/js/bootstrap.bundle.js}&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>The HTML view example above requires the <a href="https://getbootstrap.com/">Bootstrap CSS framework</a>.
You can either include Bootstrap from a content delivery network (CDN),
or add a new dependency in <code>pom.xml</code> that adds Bootstrap into the project.
If you choose to update the project dependencies in <code>pom.xml</code>,
use the following Maven dependency that includes Bootstrap:</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.webjars.npm&lt;/groupId&gt;
    &lt;artifactId&gt;bootstrap&lt;/artifactId&gt;
    &lt;version&gt;5.1.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h2 id="complete-the-basic-functionality">Complete the Basic Functionality</h2>
<p>You have known the overall groundwork required to implement a feature in the TDD approach.
The next task is to ensure the user can actually create a new todo item.
Now try to work on your own.
But do not worry, there will be hints on how to complete it.</p>
<p>Your tasks are as follows:</p>
<ol>
<li>Add a new test case in <code>TodoListControllerTest</code> that verifies the correctness of incoming HTTP POST message.
   Try to figure out how to use <code>MockMvc</code> to simulate an HTTP POST message with a data payload
   (i.e. the new todo item submitted via an HTML form).</li>
<li>Add a new method in <code>TodoListController</code> that handles incoming HTTP POST message containing the new todo item.
   Use <code>@PostMapping</code> annotation to designate the new method as the handler of an incoming HTTP POST message to <code>/list</code> path.
   You also need to add a parameter into the method, so you can obtain the new todo item in the HTTP POST message.</li>
</ol>
<p>Try to run the application from time to time.
While having test suites that are executed by a test runner is important,
do not forget to run the app manually and try using it as an actual user.
You can run the app by executing <code>main()</code> method in <code>SitodoApplication</code> class,
or by calling <code>mvnw spring-boot:run</code> Maven command.</p>
<p>If you have finished, do not forget to save your latest work as a commit and push it to GitHub:</p>
<pre><code class="language-shell">git add &lt;path to the changed files&gt;
git commit
git push
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../qa-automation/" class="btn btn-neutral float-left" title="Deployment Automation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../end-day-1/" class="btn btn-neutral float-right" title="Recap">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../qa-automation/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../end-day-1/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
